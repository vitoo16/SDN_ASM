<nav class="navigation" id="mainNav">
    <div class="nav-container">
        <div class="nav-brand">
            <a href="/" class="brand-link">
                <span class="brand-icon">ðŸŒ¸</span>
                <span class="brand-name">Odour</span>
            </a>
        </div>

        <div class="nav-search">
            <form action="/" method="GET" class="search-form">
                <input 
                    type="text" 
                    name="search" 
                    class="search-input" 
                    placeholder="Search perfumes..."
                    value="<%= typeof searchQuery !== 'undefined' ? searchQuery : '' %>"
                />
                <button type="submit" class="search-btn">
                    <span class="material-icons">search</span>
                </button>
            </form>
        </div>

        <div class="nav-actions">
            <% if (typeof user !== 'undefined' && user) { %>
                <!-- Logged in user -->
                <a href="/cart" class="nav-link cart-link">
                    <span class="material-icons">shopping_cart</span>
                    <span class="cart-badge" id="cartBadge">0</span>
                </a>
                
                <div class="user-menu">
                    <button class="user-menu-btn" onclick="toggleUserMenu()">
                        <div class="user-avatar">
                            <%= user.name.charAt(0).toUpperCase() %>
                        </div>
                        <span class="user-name"><%= user.name %></span>
                        <span class="material-icons dropdown-icon">expand_more</span>
                    </button>
                    
                    <div class="user-dropdown" id="userDropdown">
                        <a href="/profile" class="dropdown-item">
                            <span class="material-icons">person</span>
                            Profile
                        </a>
                        <% if (user.isAdmin) { %>
                            <a href="/admin" class="dropdown-item">
                                <span class="material-icons">dashboard</span>
                                Admin Dashboard
                            </a>
                        <% } %>
                        <div class="dropdown-divider"></div>
                        <form action="/auth/logout" method="POST" class="logout-form">
                            <button type="submit" class="dropdown-item logout-btn">
                                <span class="material-icons">logout</span>
                                Logout
                            </button>
                        </form>
                    </div>
                </div>
            <% } else { %>
                <!-- Guest user -->
                <a href="/auth/login" class="btn-secondary">Login</a>
                <a href="/auth/register" class="btn-primary">Sign Up</a>
            <% } %>
        </div>

        <!-- Mobile menu button -->
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
            <span class="material-icons">menu</span>
        </button>
    </div>

    <!-- Mobile menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-search">
            <form action="/" method="GET" class="search-form">
                <input 
                    type="text" 
                    name="search" 
                    class="search-input" 
                    placeholder="Search perfumes..."
                    value="<%= typeof searchQuery !== 'undefined' ? searchQuery : '' %>"
                />
                <button type="submit" class="search-btn">
                    <span class="material-icons">search</span>
                </button>
            </form>
        </div>
        
        <% if (typeof user !== 'undefined' && user) { %>
            <a href="/cart" class="mobile-menu-item">
                <span class="material-icons">shopping_cart</span>
                Cart
                <span class="cart-badge" id="mobileCartBadge">0</span>
            </a>
            <a href="/profile" class="mobile-menu-item">
                <span class="material-icons">person</span>
                Profile
            </a>
            <% if (user.isAdmin) { %>
                <a href="/admin" class="mobile-menu-item">
                    <span class="material-icons">dashboard</span>
                    Admin Dashboard
                </a>
            <% } %>
            <div class="mobile-menu-divider"></div>
            <form action="/auth/logout" method="POST">
                <button type="submit" class="mobile-menu-item logout-btn">
                    <span class="material-icons">logout</span>
                    Logout
                </button>
            </form>
        <% } else { %>
            <a href="/auth/login" class="mobile-menu-item">
                <span class="material-icons">login</span>
                Login
            </a>
            <a href="/auth/register" class="mobile-menu-item">
                <span class="material-icons">person_add</span>
                Sign Up
            </a>
        <% } %>
    </div>
</nav>

<script>
function toggleUserMenu() {
    const dropdown = document.getElementById('userDropdown');
    dropdown.classList.toggle('show');
}

function toggleMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    menu.classList.toggle('show');
}

// Close dropdowns when clicking outside
document.addEventListener('click', function(event) {
    const userMenu = document.querySelector('.user-menu');
    const dropdown = document.getElementById('userDropdown');
    
    if (userMenu && !userMenu.contains(event.target)) {
        dropdown?.classList.remove('show');
    }
});
</script>

